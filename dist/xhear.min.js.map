{"version":3,"file":"xhear.min.js","sources":["../packages/stanz/public.mjs","../packages/xhear/public.mjs","../packages/stanz/watch.mjs","../packages/stanz/array.mjs","../packages/stanz/main.mjs","../packages/stanz/accessor.mjs","../packages/xhear/accessor.mjs","../packages/xhear/render/render.mjs","../packages/xhear/render/sync.mjs","../packages/xhear/event.mjs","../packages/xhear/array.mjs","../packages/stanz/base.mjs","../packages/xhear/form.mjs","../packages/xhear/css.mjs","../packages/xhear/register.mjs","../packages/xhear/render/fake-node.mjs","../packages/xhear/render/condition.mjs","../packages/xhear/render/fill.mjs","../packages/xhear/main.mjs","../packages/xhear/util.mjs","../packages/xhear/dollar.mjs","../packages/xhear/base.mjs"],"sourcesContent":["export const getRandomId = () => Math.random().toString(32).slice(2);\n\nconst objectToString = Object.prototype.toString;\nexport const getType = (value) =>\n  objectToString\n    .call(value)\n    .toLowerCase()\n    .replace(/(\\[object )|(])/g, \"\");\n\nexport const isObject = (obj) => {\n  const type = getType(obj);\n  return type === \"array\" || type === \"object\";\n};\n\nexport const isDebug = {\n  value: null,\n};\n\nif (typeof document !== \"undefined\") {\n  if (document.currentScript) {\n    isDebug.value = document.currentScript.attributes.hasOwnProperty(\"debug\");\n  } else {\n    isDebug.value = true;\n  }\n}\n\nlet asyncsCounter = 0;\nlet afterTimer;\nconst tickSets = new Set();\nexport function nextTick(callback) {\n  clearTimeout(afterTimer);\n  afterTimer = setTimeout(() => {\n    asyncsCounter = 0;\n  });\n\n  if (isDebug.value) {\n    Promise.resolve().then(() => {\n      asyncsCounter++;\n      if (asyncsCounter > 100000) {\n        const desc = `nextTick exceeds thread limit`;\n        console.error({\n          desc,\n          lastCall: callback,\n        });\n        throw new Error(desc);\n      }\n\n      callback();\n    });\n    return;\n  }\n\n  const tickId = `t-${getRandomId()}`;\n  tickSets.add(tickId);\n  Promise.resolve().then(() => {\n    asyncsCounter++;\n    // console.log(\"asyncsCounter => \", asyncsCounter);\n    if (asyncsCounter > 50000) {\n      tickSets.clear();\n      const desc = `nextTick exceeds thread limit`;\n      console.error({\n        desc,\n        lastCall: callback,\n      });\n      throw new Error(desc);\n    }\n    if (tickSets.has(tickId)) {\n      callback();\n      tickSets.delete(tickId);\n    }\n  });\n  return tickId;\n}\n\n// export const clearTick = (id) => tickSets.delete(id);\n\nexport function debounce(func, wait = 0) {\n  let timeout = null;\n  let hisArgs = [];\n\n  return function (...args) {\n    hisArgs.push(...args);\n\n    if (wait > 0) {\n      clearTimeout(timeout);\n      timeout = setTimeout(() => {\n        func.call(this, hisArgs);\n        hisArgs = [];\n        timeout = null;\n      }, wait);\n    } else {\n      if (timeout === null) {\n        timeout = 1;\n        nextTick(() => {\n          timeout = null;\n          const args = hisArgs.slice();\n          hisArgs = [];\n          func.call(this, args);\n        });\n      }\n    }\n  };\n}\n\n// Enhanced methods for extending objects\nexport const extend = (_this, proto, descriptor = {}) => {\n  [\n    ...Object.getOwnPropertyNames(proto),\n    ...Object.getOwnPropertySymbols(proto),\n  ].forEach((k) => {\n    const result = Object.getOwnPropertyDescriptor(proto, k);\n    const { configurable, enumerable, writable, get, set, value } = result;\n\n    if (\"value\" in result) {\n      if (_this.hasOwnProperty(k)) {\n        _this[k] = value;\n      } else {\n        Object.defineProperty(_this, k, {\n          enumerable,\n          configurable,\n          writable,\n          ...descriptor,\n          value,\n        });\n      }\n    } else {\n      Object.defineProperty(_this, k, {\n        enumerable,\n        configurable,\n        ...descriptor,\n        get,\n        set,\n      });\n    }\n  });\n\n  return _this;\n};\n\nexport function dataRevoked(data) {\n  try {\n    data.xid;\n  } catch (err) {\n    return isRevokedErr(err);\n  }\n\n  return false;\n}\n\nexport function isRevokedErr(error) {\n  const firstLine = error.stack.split(/\\\\n/)[0].toLowerCase();\n  if (firstLine.includes(\"proxy\") && firstLine.includes(\"revoked\")) {\n    return true;\n  }\n\n  return false;\n}\n","import { getType } from \"../stanz/public.mjs\";\n\nexport const isFunction = (val) => getType(val).includes(\"function\");\n\nexport const hyphenToUpperCase = (str) =>\n  str.replace(/-([a-z])/g, (match, p1) => {\n    return p1.toUpperCase();\n  });\n\nexport function capitalizeFirstLetter(str) {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\nexport const isArrayEqual = (arr1, arr2) => {\n  if (arr1.length !== arr2.length) {\n    return false;\n  }\n  for (let i = 0, len = arr1.length; i < len; i++) {\n    if (arr1[i] !== arr2[i]) {\n      return false;\n    }\n  }\n  return true;\n};\n\nexport const toDashCase = (str) => {\n  return str.replace(/[A-Z]/g, function (match) {\n    return \"-\" + match.toLowerCase();\n  });\n};\n\n// Determine if an element is eligible\nexport const meetsEle = (ele, expr) => {\n  const temp = document.createElement(\"template\");\n  temp.content.append(ele.cloneNode());\n  return !!temp.content.querySelector(expr);\n};\n\nexport function isEmptyObject(obj) {\n  if (!obj) {\n    return false;\n  }\n  for (var key in obj) {\n    if (obj.hasOwnProperty(key)) {\n      return false;\n    }\n  }\n  return true;\n}\n\nexport function moveArrayValue(arr, oldValue, newIndex) {\n  const oldIndex = arr.indexOf(oldValue);\n\n  if (oldIndex === -1) {\n    throw new Error(\"Value not found in array\");\n  }\n\n  arr.splice(newIndex, 0, arr.splice(oldIndex, 1)[0]);\n  return arr;\n}\n\nexport const removeArrayValue = (arr, target) => {\n  const index = arr.indexOf(target);\n  if (index > -1) {\n    arr.splice(index, 1);\n  }\n};\n\nexport const searchEle = (el, expr) => {\n  if (el instanceof HTMLTemplateElement) {\n    return Array.from(el.content.querySelectorAll(expr));\n  }\n  return Array.from(el.querySelectorAll(expr));\n};\n\nexport function mergeObjects(obj1, obj2) {\n  for (let key of Object.keys(obj1)) {\n    if (!obj2.hasOwnProperty(key)) {\n      delete obj1[key];\n    }\n  }\n\n  for (let [key, value] of Object.entries(obj2)) {\n    obj1[key] = value;\n  }\n}\n\nexport const isSafariBrowser = () =>\n  /^((?!chrome|android).)*safari/i.test(navigator.userAgent);\n","import { getRandomId, debounce, dataRevoked } from \"./public.mjs\";\nimport { WATCHS } from \"./main.mjs\";\nconst { assign, freeze } = Object;\n\nclass Watcher {\n  constructor(opts) {\n    assign(this, opts);\n    freeze(this);\n  }\n\n  hasModified(k) {\n    if (this.type === \"array\") {\n      return this.path.includes(this.currentTarget.get(k));\n    }\n\n    const keys = k.split(\".\");\n\n    if (this.currentTarget === this.target && this.name === keys[0]) {\n      return true;\n    }\n\n    const modifieds = getModifieds(this, keys);\n\n    const positionIndex = modifieds.indexOf(this.target);\n    if (positionIndex > -1) {\n      const currentKeys = keys.slice(positionIndex + 1);\n\n      if (!currentKeys.length) {\n        // This is listening for changes in the child object itself\n        return true;\n      }\n\n      return this.name === currentKeys[0];\n    }\n\n    // Data belonging to the chain of change\n    return this.path.includes(this.currentTarget[k]);\n  }\n\n  hasReplaced(k) {\n    if (this.type !== \"set\") {\n      return false;\n    }\n\n    const keys = k.split(\".\");\n\n    if (this.target === this.currentTarget && this.name === keys[0]) {\n      return true;\n    }\n\n    const modifieds = getModifieds(this, keys);\n\n    const positionIndex = modifieds.indexOf(this.target);\n\n    if (positionIndex > -1) {\n      const currentKeys = keys.slice(positionIndex + 1);\n\n      return currentKeys[0] === this.name;\n    }\n\n    return false;\n  }\n}\n\nconst getModifieds = (_this, keys) => {\n  const modifieds = [];\n\n  const cloneKeys = keys.slice();\n  let target = _this.currentTarget;\n  while (cloneKeys.length) {\n    const targetKey = cloneKeys.shift();\n    if (target) {\n      target = target[targetKey];\n    }\n\n    modifieds.push(target);\n  }\n\n  return modifieds;\n};\n\nclass Watchers extends Array {\n  constructor(arr) {\n    super(...arr);\n  }\n\n  hasModified(key) {\n    return this.some((e) => e.hasModified(key));\n  }\n\n  hasReplaced(key) {\n    return this.some((e) => e.hasReplaced(key));\n  }\n}\n\nexport const emitUpdate = ({\n  type,\n  currentTarget,\n  target,\n  name,\n  value,\n  oldValue,\n  args,\n  path = [],\n}) => {\n  if (path && path.includes(currentTarget)) {\n    console.warn(\"Circular references appear\");\n    return;\n  }\n\n  let options = {\n    type,\n    target,\n    name,\n    oldValue,\n    value,\n  };\n\n  if (type === \"array\") {\n    delete options.value;\n    options.args = args;\n  }\n\n  if (currentTarget._hasWatchs) {\n    const watcher = new Watcher({\n      currentTarget,\n      ...options,\n      path: [...path],\n    });\n\n    currentTarget[WATCHS].forEach((func) => {\n      func(watcher);\n    });\n  }\n\n  currentTarget._update &&\n    currentTarget.owner.forEach((parent) => {\n      emitUpdate({\n        currentTarget: parent,\n        ...options,\n        path: [currentTarget, ...path],\n      });\n    });\n};\n\nexport default {\n  watch(callback) {\n    const wid = \"w-\" + getRandomId();\n\n    this[WATCHS].set(wid, callback);\n\n    return wid;\n  },\n\n  unwatch(wid) {\n    return this[WATCHS].delete(wid);\n  },\n\n  watchTick(callback, wait) {\n    return this.watch(\n      debounce((arr) => {\n        if (dataRevoked(this)) {\n          // console.warn(`The revoked object cannot use watchTick : `, this);\n          return;\n        }\n        arr = arr.filter((e) => {\n          try {\n            e.path.forEach((item) => item.xid);\n          } catch (err) {\n            return false;\n          }\n\n          return true;\n        });\n\n        callback(new Watchers(arr));\n      }, wait || 0)\n    );\n  },\n  // For manual use of emitUpdate\n  refresh(opts) {\n    const options = {\n      ...opts,\n      type: \"refresh\",\n      target: this,\n      currentTarget: this,\n    };\n    emitUpdate(options);\n  },\n  watchUntil(func) {\n    return new Promise((resolve) => {\n      let f;\n      const tid = this.watch(\n        (f = () => {\n          const bool = func();\n          if (bool) {\n            this.unwatch(tid);\n            resolve(this);\n          }\n        })\n      );\n\n      f();\n    });\n  },\n};\n","import { clearData } from \"./accessor.mjs\";\nimport { SELF, PROXY, isxdata } from \"./main.mjs\";\nimport { isObject } from \"./public.mjs\";\nimport { emitUpdate } from \"./watch.mjs\";\n\nconst mutatingMethods = [\n  \"push\",\n  \"pop\",\n  \"shift\",\n  \"unshift\",\n  \"splice\",\n  \"reverse\",\n  \"sort\",\n  \"fill\",\n  \"copyWithin\",\n];\n\nconst holder = Symbol(\"placeholder\");\n\nfunction compareArrays(oldArray, newArray) {\n  const backupNewArray = Array.from(newArray);\n  const backupOldArray = Array.from(oldArray);\n  const deletedItems = [];\n  const addedItems = new Map();\n\n  const oldLen = oldArray.length;\n  for (let i = 0; i < oldLen; i++) {\n    const oldItem = oldArray[i];\n    const newIndex = backupNewArray.indexOf(oldItem);\n    if (newIndex > -1) {\n      backupNewArray[newIndex] = holder;\n    } else {\n      deletedItems.push(oldItem);\n    }\n  }\n\n  const newLen = newArray.length;\n  for (let i = 0; i < newLen; i++) {\n    const newItem = newArray[i];\n    const oldIndex = backupOldArray.indexOf(newItem);\n    if (oldIndex > -1) {\n      backupOldArray[oldIndex] = holder;\n    } else {\n      addedItems.set(i, newItem);\n    }\n  }\n\n  return { deletedItems, addedItems };\n}\n\nconst fn = {};\n\nconst arrayFn = Array.prototype;\n\nmutatingMethods.forEach((methodName) => {\n  if (arrayFn[methodName]) {\n    fn[methodName] = function (...args) {\n      const backupArr = Array.from(this);\n\n      const reval = arrayFn[methodName].apply(this[SELF], args);\n\n      const { deletedItems, addedItems } = compareArrays(backupArr, this);\n\n      // Refactoring objects as proxy instances\n      for (let [key, value] of addedItems) {\n        if (isxdata(value)) {\n          value._owner.push(this);\n        } else if (isObject(value)) {\n          this.__unupdate = 1;\n          this[key] = value;\n          delete this.__unupdate;\n        }\n      }\n\n      for (let item of deletedItems) {\n        clearData(item, this);\n      }\n\n      emitUpdate({\n        type: \"array\",\n        currentTarget: this,\n        target: this,\n        args,\n        name: methodName,\n        oldValue: backupArr,\n      });\n\n      if (reval === this[SELF]) {\n        return this[PROXY];\n      }\n\n      return reval;\n    };\n  }\n});\n\n// Object.getOwnPropertyNames(Array.prototype).forEach((methodName) => {\n[\"concat\", \"filter\", \"slice\", \"flatMap\", \"map\"].forEach((methodName) => {\n  if (methodName === \"constructor\" || mutatingMethods.includes(methodName)) {\n    return;\n  }\n\n  const oldFunc = Array.prototype[methodName];\n  if (oldFunc instanceof Function) {\n    fn[methodName] = function (...args) {\n      return oldFunc.call(Array.from(this), ...args);\n    };\n  }\n});\n\nexport default fn;\n","import { extend, getRandomId } from \"./public.mjs\";\nimport { handler as stanzHandler } from \"./accessor.mjs\";\nimport arrayFn from \"./array.mjs\";\nimport watchFn from \"./watch.mjs\";\nconst { defineProperties, getOwnPropertyDescriptor, entries } = Object;\n\nexport const SELF = Symbol(\"self\");\nexport const PROXY = Symbol(\"proxy\");\nexport const WATCHS = Symbol(\"watchs\");\nexport const ISXDATA = Symbol(\"isxdata\");\n\nexport const isxdata = (val) => val && !!val[ISXDATA];\n\nexport function constructor(data, handler = stanzHandler) {\n  // const proxySelf = new Proxy(this, handler);\n  let { proxy: proxySelf, revoke } = Proxy.revocable(this, handler);\n\n  // Determines the properties of the listener bubble\n  proxySelf._update = 1;\n\n  let watchs;\n\n  defineProperties(this, {\n    xid: { value: data.xid || getRandomId() },\n    // Save all parent objects\n    _owner: {\n      value: [],\n    },\n    owner: {\n      configurable: true,\n      get() {\n        return new Set(this._owner);\n      },\n    },\n    [ISXDATA]: {\n      value: true,\n    },\n    [SELF]: {\n      configurable: true,\n      get: () => this,\n    },\n    [PROXY]: {\n      configurable: true,\n      get: () => proxySelf,\n    },\n    // Save the object of the listener function\n    [WATCHS]: {\n      get: () => watchs || (watchs = new Map()),\n    },\n    _hasWatchs: {\n      get: () => !!watchs,\n    },\n    _revoke: {\n      value: revoke,\n    },\n  });\n\n  Object.keys(data).forEach((key) => {\n    const descObj = getOwnPropertyDescriptor(data, key);\n    let { value, get, set } = descObj;\n\n    if (get || set) {\n      defineProperties(this, {\n        [key]: descObj,\n      });\n    } else {\n      // Set the function directly\n      proxySelf[key] = value;\n    }\n  });\n\n  return proxySelf;\n}\n\nexport default class Stanz extends Array {\n  constructor(data) {\n    super();\n\n    return constructor.call(this, data);\n  }\n\n  // This method is still in the experimental period\n  revoke() {\n    const self = this[SELF];\n\n    if (self._onrevokes) {\n      self._onrevokes.forEach((f) => f());\n      self._onrevokes.length = 0;\n    }\n\n    self.__unupdate = 1;\n\n    self[WATCHS].clear();\n\n    entries(this).forEach(([name, value]) => {\n      if (isxdata(value)) {\n        this[name] = null;\n      }\n    });\n\n    self._owner.forEach((parent) => {\n      entries(parent).forEach(([name, value]) => {\n        if (value === this) {\n          parent[name] = null;\n        }\n      });\n    });\n\n    delete self[SELF];\n    delete self[PROXY];\n    self._revoke();\n  }\n\n  toJSON() {\n    let obj = {};\n\n    let isPureArray = true;\n    let maxId = -1;\n\n    Object.keys(this).forEach((k) => {\n      let val = this[k];\n\n      if (!/\\D/.test(k)) {\n        k = parseInt(k);\n        if (k > maxId) {\n          maxId = k;\n        }\n      } else {\n        isPureArray = false;\n      }\n\n      if (isxdata(val)) {\n        val = val.toJSON();\n      }\n\n      obj[k] = val;\n    });\n\n    if (isPureArray) {\n      obj.length = maxId + 1;\n      obj = Array.from(obj);\n    }\n\n    const xid = this.xid;\n    defineProperties(obj, {\n      xid: {\n        get: () => xid,\n      },\n    });\n\n    return obj;\n  }\n\n  toString() {\n    return JSON.stringify(this.toJSON());\n  }\n\n  extend(obj, desc) {\n    return extend(this, obj, desc);\n  }\n\n  get(key) {\n    if (/\\./.test(key)) {\n      const keys = key.split(\".\");\n      let target = this;\n      for (let i = 0, len = keys.length; i < len; i++) {\n        try {\n          target = target[keys[i]];\n        } catch (error) {\n          const err = new Error(\n            `Failed to get data : ${keys.slice(0, i).join(\".\")} \\n${\n              error.stack\n            }`,\n            { cause: error }\n          );\n          Object.assign(err, {\n            target,\n          });\n          throw err;\n        }\n      }\n\n      return target;\n    }\n\n    return this[key];\n  }\n  set(key, value) {\n    if (/\\./.test(key)) {\n      const keys = key.split(\".\");\n      const lastKey = keys.pop();\n      let target = this;\n      for (let i = 0, len = keys.length; i < len; i++) {\n        try {\n          target = target[keys[i]];\n        } catch (error) {\n          const err = new Error(\n            `Failed to get data : ${keys.slice(0, i).join(\".\")} \\n${\n              error.stack\n            }`,\n            { cause: error }\n          );\n          Object.assign(err, {\n            target,\n          });\n          throw err;\n        }\n      }\n\n      return (target[lastKey] = value);\n    }\n\n    return (this[key] = value);\n  }\n}\n\nStanz.prototype.extend(\n  { ...watchFn, ...arrayFn },\n  {\n    enumerable: false,\n  }\n);\n","import { isObject } from \"./public.mjs\";\nimport Stanz, { PROXY, isxdata } from \"./main.mjs\";\nimport { emitUpdate } from \"./watch.mjs\";\n\nconst { defineProperties } = Object;\n\nexport const setData = ({ target, key, value, receiver, type, succeed }) => {\n  const oldValue = receiver[key];\n\n  let data = value;\n  if (isxdata(data)) {\n    if (oldValue === value) {\n      return true;\n    }\n    data._owner.push(receiver);\n  } else if (isObject(value)) {\n    const desc = Object.getOwnPropertyDescriptor(target, key);\n    if (!desc || desc.hasOwnProperty(\"value\")) {\n      data = new Stanz(value);\n      data._owner.push(receiver);\n    }\n  }\n\n  const isSame = oldValue === value;\n\n  if (!isSame && isxdata(oldValue)) {\n    clearData(oldValue, receiver);\n  }\n\n  const reval = succeed(data);\n\n  !isSame &&\n    // __unupdate: Let the system not trigger an upgrade, system self-use attribute\n    !target.__unupdate &&\n    emitUpdate({\n      type: type || \"set\",\n      target: receiver,\n      currentTarget: receiver,\n      name: key,\n      value,\n      oldValue,\n    });\n\n  return reval;\n};\n\nexport const clearData = (val, target) => {\n  if (isxdata(val)) {\n    const index = val._owner.indexOf(target);\n    if (index > -1) {\n      val._owner.splice(index, 1);\n    } else {\n      console.error({\n        desc: \"This data is wrong, the owner has no boarding object at the time of deletion\",\n        target,\n        mismatch: val,\n      });\n    }\n  }\n};\n\nexport const handler = {\n  set(target, key, value, receiver) {\n    if (typeof key === \"symbol\") {\n      return Reflect.set(target, key, value, receiver);\n    }\n\n    // Set properties with _ prefix directly\n    if (/^_/.test(key)) {\n      if (!target.hasOwnProperty(key)) {\n        defineProperties(target, {\n          [key]: {\n            writable: true,\n            configurable: true,\n            value,\n          },\n        });\n      } else {\n        Reflect.set(target, key, value, receiver);\n      }\n      return true;\n    }\n\n    try {\n      return setData({\n        target,\n        key,\n        value,\n        receiver,\n        succeed(data) {\n          return Reflect.set(target, key, data, receiver);\n        },\n      });\n    } catch (error) {\n      const err = new Error(`failed to set ${key} \\n ${error.stack}`, {\n        cause: error,\n      });\n\n      Object.assign(err, {\n        key,\n        value,\n        target: receiver,\n      });\n\n      throw err;\n    }\n  },\n  deleteProperty(target, key) {\n    if (/^_/.test(key) || typeof key === \"symbol\") {\n      return Reflect.deleteProperty(target, key);\n    }\n\n    return setData({\n      target,\n      key,\n      value: undefined,\n      receiver: target[PROXY],\n      type: \"delete\",\n      succeed() {\n        return Reflect.deleteProperty(target, key);\n      },\n    });\n  },\n};\n","import { eleX } from \"./util.mjs\";\nimport { handler as stanzHandler } from \"../stanz/accessor.mjs\";\n\n// const tempEl = document.createElement(\"template\");\n\nexport const handler = {\n  set(target, key, value, receiver) {\n    if (!/\\D/.test(String(key))) {\n      return Reflect.set(target, key, value, receiver);\n    }\n\n    if (target[key] === value) {\n      // Optimise performance;\n      // fix focus remapping caused by 'text' being reset\n      return true;\n    }\n\n    if (key === \"html\") {\n      // When setting HTML values that contain single quotes, they become double quotes when set, leading to an infinite loop of updates.\n      // tempEl.innerHTML = value;\n      // value = tempEl.innerHTML;\n\n      // If custom elements are stuffed, the html values may remain inconsistent\n      return Reflect.set(target, key, value, receiver);\n    }\n\n    return stanzHandler.set(target, key, value, receiver);\n  },\n  get(target, key, receiver) {\n    if (!/\\D/.test(String(key))) {\n      return eleX(target.ele.children[key]);\n    }\n\n    return Reflect.get(target, key, receiver);\n  },\n  ownKeys(target) {\n    let keys = Reflect.ownKeys(target);\n    let len = target.ele.children.length;\n    for (let i = 0; i < len; i++) {\n      keys.push(String(i));\n    }\n    return keys;\n  },\n  getOwnPropertyDescriptor(target, key) {\n    if (typeof key === \"string\" && !/\\D/.test(key)) {\n      return {\n        enumerable: true,\n        configurable: true,\n      };\n    }\n    return Reflect.getOwnPropertyDescriptor(target, key);\n  },\n};\n","import { getRandomId, isRevokedErr } from \"../../stanz/public.mjs\";\nimport {\n  isFunction,\n  hyphenToUpperCase,\n  meetsEle,\n  isEmptyObject,\n  searchEle,\n  removeArrayValue as remove,\n} from \"../public.mjs\";\nimport { eleX } from \"../util.mjs\";\n\nexport const renderExtends = {\n  beforeRender() {},\n  render() {},\n};\n\nconst getRevokes = (target) => target.__revokes || (target.__revokes = []);\nconst addRevoke = (target, revoke) => getRevokes(target).push(revoke);\n\nconst convertToFunc = (expr, data, opts) => {\n  const funcStr = `\nconst isRevokedErr = ${isRevokedErr.toString()}\nconst [$event] = $args;\nconst {data, errCall} = this;\ntry{\n  with(data){\n    return ${expr};\n  }\n}catch(error){\n  if(isRevokedErr(error)){\n    return;\n  }\n  if(data.ele && !data.ele.isConnected){\n    return;\n  }\n  if(errCall){\n    const result = errCall(error);\n    if(result !== false){\n      console.error(error);\n    }\n  }else{\n    console.error(error);\n  }\n}\n`;\n  return new Function(\"...$args\", funcStr).bind({ data, ...opts });\n};\n\nexport function render({\n  data,\n  target,\n  template,\n  temps,\n  isRenderSelf,\n  ...otherOpts\n}) {\n  const content = template && template.innerHTML;\n\n  if (content) {\n    target.innerHTML = content;\n  }\n\n  renderExtends.beforeRender({\n    target,\n  });\n\n  const texts = searchEle(target, \"xtext\");\n\n  const tasks = [];\n  const revokes = getRevokes(target);\n\n  // Styles with data() function to monitor and correct rendering\n  searchEle(target, \"style\").forEach((el) => {\n    const originStyle = el.innerHTML;\n\n    if (/data\\(.+\\)/.test(originStyle)) {\n      const matchs = Array.from(new Set(originStyle.match(/data\\(.+?\\)/g))).map(\n        (dataExpr) => {\n          const expr = dataExpr.replace(/data\\((.+)\\)/, \"$1\");\n          const func = convertToFunc(expr, data);\n\n          return {\n            dataExpr,\n            func,\n          };\n        }\n      );\n\n      const renderStyle = () => {\n        let afterStyle = originStyle;\n\n        matchs.forEach(({ dataExpr, func }) => {\n          afterStyle = afterStyle.replace(dataExpr, func());\n        });\n\n        if (el.innerHTML !== afterStyle) {\n          el.innerHTML = afterStyle;\n        }\n      };\n      tasks.push(renderStyle);\n\n      const revokeStyle = () => {\n        matchs.length = 0;\n        remove(tasks, renderStyle);\n        remove(getRevokes(el), revokeStyle);\n        remove(revokes, revokeStyle);\n      };\n\n      addRevoke(el, revokeStyle);\n      revokes.push(revokeStyle);\n    }\n  });\n\n  // Render text nodes\n  texts.forEach((el) => {\n    const textEl = document.createTextNode(\"\");\n    const { parentNode } = el;\n    parentNode.insertBefore(textEl, el);\n    parentNode.removeChild(el);\n\n    const func = convertToFunc(el.getAttribute(\"expr\"), data);\n    const renderFunc = () => {\n      const content = func();\n      if (textEl.textContent !== String(content)) {\n        textEl.textContent = content;\n      }\n    };\n    tasks.push(renderFunc);\n\n    const textRevoke = () => {\n      remove(revokes, textRevoke);\n      remove(tasks, renderFunc);\n      remove(getRevokes(textEl), textRevoke);\n    };\n    revokes.push(textRevoke);\n    addRevoke(textEl, textRevoke);\n  });\n\n  const eles = searchEle(target, `[x-bind-data]`);\n\n  if (isRenderSelf && meetsEle(target, `[x-bind-data]`)) {\n    eles.unshift(target);\n  }\n\n  // Render properties based on expressions\n  eles.forEach((el) => {\n    const bindData = JSON.parse(el.getAttribute(\"x-bind-data\"));\n\n    const $el = eleX(el);\n\n    for (let [actionName, arr] of Object.entries(bindData)) {\n      arr.forEach((args) => {\n        try {\n          const { always } = $el[actionName];\n          let afterArgs = [];\n\n          let workResult;\n\n          const work = () => {\n            const [key, expr] = args;\n\n            const func = convertToFunc(expr, data, {\n              errCall: (error) => {\n                const stack = `Rendering of target element failed: ${$el.ele.outerHTML} \\n  ${error.stack}`;\n                console.error(stack);\n                console.error({ stack, element: $el.ele, target, error });\n\n                return false;\n              },\n            });\n\n            afterArgs = [key, func];\n\n            const reval = $el[actionName](...afterArgs, {\n              actionName,\n              target: $el,\n              data,\n              beforeArgs: args,\n              args: afterArgs,\n            });\n\n            renderExtends.render({\n              step: \"refresh\",\n              args,\n              name: actionName,\n              target: $el,\n            });\n\n            return reval;\n          };\n\n          let clearRevs = () => {\n            const { revoke: methodRevoke } = $el[actionName];\n\n            if (methodRevoke) {\n              methodRevoke({\n                actionName,\n                target: $el,\n                data,\n                beforeArgs: args,\n                args: afterArgs,\n                result: workResult,\n              });\n            }\n\n            remove(revokes, clearRevs);\n            remove(getRevokes(el), clearRevs);\n            remove(tasks, work);\n            clearRevs = null;\n          };\n\n          if (always) {\n            // Run every data update\n            tasks.push(work);\n          } else {\n            workResult = work();\n          }\n\n          revokes.push(clearRevs);\n          if (el !== target) {\n            addRevoke(el, clearRevs);\n          }\n        } catch (error) {\n          const err = new Error(\n            `Execution of the ${actionName} method reports an error: ${actionName}:${args[0]}=\"${args[1]}\"  \\n ${error.stack}`,\n            {\n              cause: error,\n            }\n          );\n          throw err;\n        }\n      });\n    }\n\n    el.removeAttribute(\"x-bind-data\");\n\n    el._bindingRendered = true;\n    el.dispatchEvent(new Event(\"binding-rendered\"));\n  });\n\n  if (!target.__render_temps && !isEmptyObject(temps)) {\n    target.__render_temps = temps;\n  }\n\n  if (tasks.length) {\n    if (target.__render_data && target.__render_data !== data) {\n      const error = new Error(\n        `An old listener already exists and the rendering of this element may be wrong`\n      );\n\n      Object.assign(error, {\n        element: target,\n        old: target.__render_data,\n        new: data,\n      });\n\n      throw error;\n    }\n\n    target.__render_data = data;\n\n    tasks.forEach((f) => f());\n\n    // After the data changes, traverse the rendering tasks\n    const wid = data.watchTick((e) => {\n      if (tasks.length) {\n        tasks.forEach((f) => f());\n      } else {\n        data.unwatch(wid);\n      }\n    });\n  }\n\n  renderExtends.render({ step: \"init\", target });\n}\n\nconst convertEl = (el) => {\n  const { tagName } = el;\n\n  if (tagName === \"TEMPLATE\") {\n    return;\n  }\n\n  if (tagName) {\n    // Converting elements\n    const obj = {};\n\n    Array.from(el.attributes).forEach((attr) => {\n      const matchData = /(.*):(.+)/.exec(attr.name);\n\n      if (!matchData) {\n        return;\n      }\n\n      let [, actionName, param0] = matchData;\n\n      if (!actionName) {\n        actionName = \"prop\";\n      }\n\n      const targetActions = obj[actionName] || (obj[actionName] = []);\n\n      targetActions.push([param0, attr.value]);\n\n      el.removeAttribute(attr.name);\n    });\n\n    const keys = Object.keys(obj);\n\n    if (keys.length) {\n      el.setAttribute(\"x-bind-data\", JSON.stringify(obj));\n    }\n  }\n\n  Array.from(el.children).forEach(convertEl);\n};\n\nconst searchTemp = (template, expr, func) => {\n  const rearr = Array.from(template.content.querySelectorAll(expr));\n\n  if (func) {\n    rearr.forEach(func);\n  }\n\n  return rearr;\n};\n\nlet isWarned;\n\nexport const convert = (template) => {\n  let temps = {};\n  const codeEls = {};\n\n  searchTemp(template, \"code\", (code) => {\n    const cid = getRandomId();\n    code.setAttribute(\"code-id\", cid);\n\n    codeEls[cid] = code.innerHTML;\n    code.innerHTML = \"\";\n  });\n\n  template.innerHTML = template.innerHTML.replace(\n    /{{(.+?)}}/g,\n    (str, match) => {\n      return `<xtext expr=\"${match}\"></xtext>`;\n    }\n  );\n\n  const tempName = template.getAttribute(\"name\");\n\n  if (tempName) {\n    const tempChilds = template.content.children;\n    if (tempChilds.length > 1) {\n      if (!isWarned) {\n        console.warn(\n          `Only one child element can be contained within a template element. If multiple child elements appear, the child elements will be rewrapped within a <div> element`\n        );\n        isWarned = 1;\n      }\n\n      const wrapName = `wrapper-${tempName}`;\n      template.innerHTML = `<div ${wrapName} style=\"display:contents\">${template.innerHTML}</div>`;\n      console.warn(\n        `The template \"${tempName}\" contains ${tempChilds.length} child elements that have been wrapped in a div element with attribute \"${wrapName}\".`\n      );\n    }\n    temps[tempName] = template;\n    template.remove();\n  }\n\n  searchTemp(template, \"x-fill:not([name])\", (fillEl) => {\n    if (fillEl.querySelector(\"x-fill:not([name])\")) {\n      throw new Error(\n        `Don't fill unnamed x-fills with unnamed x-fill elements!!!\\n${fillEl.outerHTML}`\n      );\n    }\n\n    if (fillEl.innerHTML.trim()) {\n      const tid = `t${getRandomId()}`;\n      fillEl.setAttribute(\"name\", tid);\n\n      const temp = document.createElement(\"template\");\n      temp.setAttribute(\"name\", tid);\n      temp.innerHTML = fillEl.innerHTML;\n      fillEl.innerHTML = \"\";\n      fillEl.appendChild(temp);\n    }\n  });\n\n  searchTemp(template, \"x-if,x-else-if,x-else\", (condiEl) => {\n    const firstChild = condiEl.children[0];\n    if (!firstChild || firstChild.tagName !== \"TEMPLATE\") {\n      condiEl.innerHTML = `<template condition>${condiEl.innerHTML}</template>`;\n    }\n  });\n\n  searchTemp(template, \"template\", (e) => {\n    const newTemps = convert(e);\n\n    Object.keys(newTemps).forEach((tempName) => {\n      if (temps[tempName]) {\n        throw new Error(`Template \"${tempName}\" already exists`);\n      }\n    });\n\n    temps = { ...temps, ...newTemps };\n  });\n\n  Array.from(template.content.children).forEach((el) => convertEl(el));\n\n  // Restore the contents of the code\n  for (let [key, value] of Object.entries(codeEls)) {\n    searchTemp(template, `[code-id=\"${key}\"]`, (el) => {\n      el.removeAttribute(\"code-id\");\n      // el.innerHTML = htmlEncode(value);\n      el.innerHTML = value;\n    });\n  }\n\n  return temps;\n};\n\nconst getVal = (val) => {\n  if (isFunction(val)) {\n    return val();\n  }\n\n  return val;\n};\n\nconst defaultData = {\n  prop(...args) {\n    let [name, value] = args;\n\n    if (args.length === 1) {\n      return this[name];\n    }\n\n    value = getVal(value);\n    name = hyphenToUpperCase(name);\n\n    this.set(name, value);\n  },\n  attr(...args) {\n    let [name, value] = args;\n\n    if (args.length === 1) {\n      return this.ele.getAttribute(name);\n    }\n\n    value = getVal(value);\n\n    if (value === null) {\n      this.ele.removeAttribute(name);\n    } else {\n      this.ele.setAttribute(name, value);\n    }\n  },\n  class(...args) {\n    let [name, value] = args;\n\n    if (args.length === 1) {\n      return this.ele.classList.contains(name);\n    }\n\n    value = getVal(value);\n\n    if (value) {\n      this.ele.classList.add(name);\n    } else {\n      this.ele.classList.remove(name);\n    }\n  },\n};\n\ndefaultData.prop.always = true;\ndefaultData.attr.always = true;\ndefaultData.class.always = true;\n\ndefaultData.prop.revoke = ({ target, args, $ele, data }) => {\n  const propName = args[0];\n  // target[propName] = null;\n  target.set(propName, null);\n};\n\nexport default defaultData;\n","import { hyphenToUpperCase } from \"../public.mjs\";\nimport { dataRevoked } from \"../../stanz/public.mjs\";\n\nconst syncFn = {\n  sync(propName, targetName, options) {\n    if (!options) {\n      throw new Error(`Sync is only allowed within the renderer`);\n    }\n\n    [propName, targetName] = options.beforeArgs;\n\n    propName = hyphenToUpperCase(propName);\n    targetName = hyphenToUpperCase(targetName);\n\n    const { data } = options;\n\n    const val = data.get(targetName);\n\n    if (val instanceof Object) {\n      const err = `Object values cannot be synchronized using the sync function : ${targetName}`;\n      console.log(err, data);\n      throw new Error(err);\n    }\n\n    this[propName] = data.get(targetName);\n\n    const wid1 = this.watch((e) => {\n      if (e.hasModified(propName)) {\n        try {\n          const value = this.get(propName);\n          data.set(targetName, value);\n        } catch (err) {\n          // Errors are reported when a proxy is revoked.\n          // console.warn(err);\n        }\n      }\n    });\n\n    const wid2 = data.watch((e) => {\n      if (e.hasModified(targetName)) {\n        try {\n          const value = data.get(targetName);\n          this.set(propName, value);\n        } catch (err) {\n          // Errors are reported when a proxy is revoked.\n          // console.warn(err);\n        }\n      }\n    });\n\n    return () => {\n      this.unwatch(wid1);\n      if (!dataRevoked(data)) {\n        data.unwatch(wid2);\n      }\n    };\n  },\n};\n\nsyncFn.sync.revoke = (e) => {\n  e.result();\n};\n\nexport default syncFn;\n","function getBindOptions(name, func, options) {\n  let revoker;\n  if (options) {\n    const beforeValue = options.beforeArgs[1];\n\n    if (!/[^\\d\\w_\\$\\.]/.test(beforeValue)) {\n      func = options.data.get(beforeValue).bind(options.data);\n    }\n\n    revoker = () => this.ele.removeEventListener(name, func);\n  }\n\n  return { revoker, name, func };\n}\n\nconst eventFn = {\n  on(...args) {\n    const { revoker, name, func } = getBindOptions.call(this, ...args);\n\n    this.ele.addEventListener(name, func);\n\n    if (revoker) {\n      return revoker;\n    }\n\n    return this;\n  },\n  one(...args) {\n    const { revoker, name, func } = getBindOptions.call(this, ...args);\n\n    let callback = (e) => {\n      this.off(name, callback);\n      func(e);\n    };\n\n    this.ele.addEventListener(name, callback);\n\n    if (revoker) {\n      return revoker;\n    }\n\n    return this;\n  },\n  off(name, func) {\n    this.ele.removeEventListener(name, func);\n    return this;\n  },\n  emit(name, opts) {\n    const options = { ...opts };\n\n    let data;\n    if (options.hasOwnProperty(\"data\")) {\n      data = options.data;\n      delete options.data;\n    }\n\n    let event;\n\n    if (name instanceof Event) {\n      event = name;\n    } else if (name) {\n      event = new Event(name, { bubbles: true, ...options });\n    }\n\n    data && (event.data = data);\n\n    this.ele.dispatchEvent(event);\n\n    return this;\n  },\n};\n\neventFn.on.revoke = (e) => {\n  e.result();\n};\n\neventFn.one.revoke = (e) => {\n  e.result();\n};\n\nexport default eventFn;\n","import { isFunction } from \"./public.mjs\";\nimport { createXEle, eleX } from \"./util.mjs\";\nimport { emitUpdate } from \"../stanz/watch.mjs\";\n\nconst originSplice = (ele, start, count, ...items) => {\n  const { children } = ele;\n  if (start < 0) {\n    start += ele.children.length;\n  }\n\n  if (count === undefined) {\n    count = ele.children.length - start;\n  }\n\n  const removes = [];\n  for (let i = start, len = start + count; i < len; i++) {\n    const target = children[i];\n    removes.push(target);\n  }\n\n  removes.forEach((el) => el && el.remove());\n\n  if (items.length) {\n    const frag = document.createDocumentFragment();\n    items.forEach((e) => frag.append(createXEle(e).ele));\n\n    const positionEle = children[start];\n    if (positionEle) {\n      ele.insertBefore(frag, positionEle);\n    } else {\n      ele.appendChild(frag);\n    }\n  }\n\n  return removes;\n};\n\nconst mutatingMethods = [\n  \"push\",\n  \"pop\",\n  \"shift\",\n  \"unshift\",\n  \"splice\",\n  \"reverse\",\n  \"sort\",\n  \"fill\",\n  \"copyWithin\",\n];\n\nconst likeArrayFn = {\n  push(...args) {\n    const { ele } = this;\n\n    originSplice(ele, ele.children.length, 0, ...args);\n\n    emitUpdate({\n      type: \"array\",\n      currentTarget: this,\n      target: this,\n      args,\n      name: \"push\",\n    });\n\n    return ele.children.length;\n  },\n\n  pop(...args) {\n    const { ele } = this;\n\n    const targets = originSplice(ele, ele.children.length - 1, 1, ...args);\n\n    emitUpdate({\n      type: \"array\",\n      currentTarget: this,\n      target: this,\n      args,\n      name: \"pop\",\n    });\n\n    return eleX(targets[0]);\n  },\n\n  shift(...args) {\n    const { ele } = this;\n\n    const targets = originSplice(ele, 0, 1, ...args);\n\n    emitUpdate({\n      type: \"array\",\n      currentTarget: this,\n      target: this,\n      args,\n      name: \"shift\",\n    });\n\n    return eleX(targets[0]);\n  },\n\n  unshift(...args) {\n    const { ele } = this;\n\n    originSplice(ele, 0, 0, ...args);\n\n    emitUpdate({\n      type: \"array\",\n      currentTarget: this,\n      target: this,\n      args,\n      name: \"unshift\",\n    });\n\n    return ele.children.length;\n  },\n  splice(...args) {\n    const reVal = originSplice(this.ele, ...args);\n\n    emitUpdate({\n      type: \"array\",\n      currentTarget: this,\n      target: this,\n      args,\n      name: \"splice\",\n    });\n\n    return reVal.map(eleX);\n  },\n  reverse(...args) {\n    const childs = Array.from(this.ele.childNodes);\n\n    arrayFn.reverse.call(childs, ...args);\n\n    const frag = document.createDocumentFragment();\n\n    childs.forEach((ele) => {\n      // Identify internal operations to prevent detached corrections\n      ele.__internal = 1;\n      frag.append(ele);\n    });\n\n    this.ele.append(frag);\n\n    childs.forEach((ele) => {\n      delete ele.__internal;\n    });\n\n    emitUpdate({\n      type: \"array\",\n      currentTarget: this,\n      target: this,\n      args,\n      name: \"reverse\",\n    });\n\n    return this;\n  },\n  sort(...args) {\n    const childs = Array.from(this.ele.children).map(eleX);\n\n    arrayFn.sort.call(childs, ...args);\n\n    const frag = document.createDocumentFragment();\n\n    childs.forEach((e) => {\n      e.ele.__internal = 1;\n      frag.append(e.ele);\n    });\n\n    this.ele.append(frag);\n\n    childs.forEach((e) => {\n      delete e.ele.__internal;\n    });\n\n    emitUpdate({\n      type: \"array\",\n      currentTarget: this,\n      target: this,\n      args,\n      name: \"sort\",\n    });\n\n    return this;\n  },\n};\n\nconst arrayFn = Array.prototype;\n\nObject.keys(Object.getOwnPropertyDescriptors(arrayFn)).forEach((key) => {\n  if (\n    key === \"constructor\" ||\n    key === \"length\" ||\n    mutatingMethods.includes(key)\n  ) {\n    return;\n  }\n\n  const targetFunc = arrayFn[key];\n\n  if (isFunction(targetFunc)) {\n    likeArrayFn[key] = function (...args) {\n      return targetFunc.apply(Array.from(this.ele.children).map(eleX), args);\n    };\n  }\n});\n\nexport default class LikeArray {}\n\nfor (let [name, value] of Object.entries(likeArrayFn)) {\n  Object.defineProperty(LikeArray.prototype, name, {\n    value,\n  });\n}\n","import Stanz, { isxdata } from \"./main.mjs\";\n\nconst stanz = (data) => {\n  return new Stanz(data);\n};\n\nObject.assign(stanz, { is: isxdata });\n\nexport default stanz;\n","import stanz from \"../stanz/base.mjs\";\nimport { emitUpdate } from \"../stanz/watch.mjs\";\nimport { mergeObjects, searchEle } from \"./public.mjs\";\n\nconst { defineProperty, assign } = Object;\n\nconst hasValueEleNames = [\"input\", \"textarea\", \"select\"];\n\nconst setKeys = (keys, $ele) => {\n  const { ele } = $ele;\n\n  keys.forEach((k) => {\n    if (k in ele) {\n      let isNum = false;\n      defineProperty($ele, k, {\n        enumerable: true,\n        get: () => {\n          let val = ele[k];\n          if (isNum) {\n            if (/\\D/.test(val)) {\n              isNum = false;\n            } else {\n              val = Number(val);\n            }\n          }\n          return val;\n        },\n        set: (val) => {\n          isNum = typeof val === \"number\";\n          ele[k] = val;\n        },\n      });\n    }\n  });\n};\n\nconst formEleNames = new Set([\n  ...hasValueEleNames,\n  \"option\",\n  \"button\",\n  \"label\",\n  \"fieldset\",\n  \"legend\",\n  \"form\",\n]);\n\nconst bindProp = ($ele, opts = {}) => {\n  const { name: keyName, type } = opts;\n\n  const { ele } = $ele;\n  let old = ele[keyName];\n\n  $ele.on(type, () => {\n    emitUpdate({\n      type: \"set\",\n      target: $ele,\n      currentTarget: $ele,\n      name: keyName,\n      value: ele[keyName],\n      oldValue: old,\n    });\n\n    old = ele[keyName];\n  });\n};\n\nexport const initFormEle = ($ele) => {\n  const { tag } = $ele;\n\n  if (!formEleNames.has(tag)) {\n    return;\n  }\n\n  setKeys([\"type\", \"name\", \"disabled\"], $ele);\n\n  switch (tag) {\n    case \"input\":\n      initInput($ele);\n      break;\n    case \"textarea\":\n      setKeys([\"value\"], $ele);\n      bindProp($ele, { name: \"value\", type: \"input\" });\n      break;\n    case \"option\":\n      setKeys([\"selected\", \"value\"], $ele);\n      break;\n    case \"select\":\n      {\n        const { ele } = $ele;\n        $ele.__unupdate = 1;\n        $ele.value = ele.value;\n        delete $ele.__unupdate;\n\n        $ele.watch(() => {\n          ele.value = $ele.value;\n        });\n        $ele.on(\"change\", () => {\n          $ele.value = ele.value;\n        });\n      }\n      break;\n  }\n};\n\nconst initInput = ($ele) => {\n  const type = $ele.attr(\"type\");\n\n  switch (type) {\n    case \"file\":\n      setKeys([\"multiple\", \"files\"], $ele);\n      bindProp($ele, { name: \"files\", type: \"change\" });\n      break;\n    case \"checkbox\":\n      setKeys([\"checked\", \"multiple\", \"value\"], $ele);\n      bindProp($ele, { name: \"checked\", type: \"change\" });\n      break;\n    case \"radio\":\n      setKeys([\"checked\", \"value\"], $ele);\n      bindProp($ele, { name: \"checked\", type: \"change\" });\n      break;\n    case \"text\":\n    default:\n      setKeys([\"placeholder\", \"value\"], $ele);\n      bindProp($ele, { name: \"value\", type: \"input\" });\n      break;\n  }\n};\n\nconst getFormData = (target, expr) => {\n  const data = {};\n\n  target.all(expr).forEach(($el) => {\n    const { name, tag, ele } = $el;\n\n    if (tag === \"input\") {\n      switch ($el.type) {\n        case \"checkbox\":\n          if (!(name in data)) {\n            data[name] = [];\n          }\n\n          if (ele.checked) {\n            data[name].push(ele.value);\n          }\n          break;\n        case \"radio\":\n          if (ele.checked) {\n            data[name] = ele.value;\n          }\n          break;\n        case \"file\":\n          data[name] = ele.files;\n          break;\n        default:\n          data[name] = ele.value;\n      }\n    } else if (tag === \"textarea\") {\n      data[name] = ele.value;\n    } else if (tag === \"select\") {\n      const selectedsOpt = searchEle(ele, `option:checked`);\n\n      if (ele.multiple) {\n        data[name] = selectedsOpt.map((e) => e.value || e.textContent);\n      } else {\n        const [e] = selectedsOpt;\n        data[name] = e.value || e.textContent;\n      }\n    } else {\n      // custom element\n      data[name] = $el.value;\n    }\n  });\n\n  return data;\n};\n\nexport default {\n  // This method is still being tested\n  formData(expr, opts = { wait: 200 }) {\n    const data = stanz({});\n\n    assign(data, getFormData(this, expr || \"input,select,textarea\"));\n\n    const wid1 = this.watchTick((e) => {\n      const newData = getFormData(this, expr || \"input,select,textarea\");\n      mergeObjects(data, newData);\n    }, opts.wait);\n\n    const wid2 = data.watchTick((e) => {\n      resetValue(this, expr || \"input,select,textarea\", data);\n    });\n\n    const _this = this;\n\n    const oldRevoke = data.revoke;\n    data.extend({\n      revoke() {\n        _this.unwatch(wid1);\n        data.unwatch(wid2);\n        oldRevoke.call(this);\n      },\n    });\n\n    return data;\n  },\n};\n\nfunction resetValue(el, expr, data) {\n  const eles = el.all(expr);\n\n  Object.keys(data).forEach((name) => {\n    const targets = eles.filter((e) => e.attr(\"name\") === name);\n\n    if (targets.length === 0) {\n      return;\n    }\n\n    const val = data[name];\n    const target = targets[0];\n    const type = target.attr(\"type\");\n    if (targets.length === 1) {\n      let isUseValue = true;\n\n      if (target.tag === \"input\" && (type === \"radio\" || type === \"checkbox\")) {\n        isUseValue = false;\n      }\n\n      if (isUseValue) {\n        if (target.value !== val) {\n          target.value = val;\n        }\n        return;\n      }\n    }\n\n    // checkbox or radio\n    targets.forEach((e) => {\n      switch (e.attr(\"type\")) {\n        case \"radio\":\n          if (e.value === val) {\n            e.checked = true;\n          } else {\n            e.checked = false;\n          }\n          break;\n        case \"checkbox\":\n          e.checked = val.includes(e.value);\n          break;\n      }\n    });\n  });\n}\n","import { getType } from \"../stanz/public.mjs\";\n\nconst cssHandler = {\n  set(target, key, value, receiver) {\n    target._ele.style[key] = value;\n    Reflect.set(target, key, value, receiver);\n    return true;\n  },\n  get(target, key, receiver) {\n    if (key === \"length\") {\n      return 0;\n    }\n\n    const { style } = target._ele;\n    if (Array.from(style).includes(key)) {\n      return style[key];\n    }\n\n    return getComputedStyle(target._ele)[key];\n  },\n};\n\nclass XhearCSS {\n  constructor($el) {\n    const obj = {};\n\n    Object.defineProperty(obj, \"_ele\", {\n      enumerable: false,\n      get: () => $el.ele,\n    });\n\n    const { style } = $el.ele;\n\n    Array.from(style).forEach((key) => {\n      obj[key] = style[key];\n    });\n\n    return ($el._css = new Proxy(obj, cssHandler));\n  }\n}\n\nexport default {\n  get css() {\n    return new XhearCSS(this);\n  },\n  set css(d) {\n    if (getType(d) == \"string\") {\n      this.ele.style = d;\n      return;\n    }\n\n    let { style } = this;\n\n    // Covering the old style\n    let nextKeys = Object.keys(d);\n\n    // Clear the unused key\n    Array.from(style).forEach((k) => {\n      if (!nextKeys.includes(k)) {\n        style[k] = \"\";\n      }\n    });\n\n    Object.assign(style, d);\n  },\n};\n","import { getType } from \"../stanz/public.mjs\";\nimport {\n  hyphenToUpperCase,\n  capitalizeFirstLetter,\n  toDashCase,\n} from \"./public.mjs\";\nimport { convert, render } from \"./render/render.mjs\";\nimport { eleX } from \"./util.mjs\";\n\nconst COMPS = {};\n\nexport const renderElement = ({ defaults, ele, template, temps }) => {\n  let $ele;\n\n  try {\n    const data = {\n      ...deepCopyData(defaults.data),\n      ...defaults.attrs,\n    };\n\n    defaults.attrs &&\n      Object.keys(defaults.attrs).forEach((name) => {\n        const value = ele.getAttribute(toDashCase(name));\n        if (value !== null && value !== undefined) {\n          data[name] = value;\n        }\n      });\n\n    $ele = eleX(ele);\n\n    defaults.proto && $ele.extend(defaults.proto, { enumerable: false });\n\n    for (let [key, value] of Object.entries(data)) {\n      if (!$ele.hasOwnProperty(key)) {\n        $ele[key] = value;\n      }\n    }\n\n    if (defaults.temp) {\n      const root = ele.attachShadow({ mode: \"open\" });\n\n      root.innerHTML = template.innerHTML;\n\n      render({\n        target: root,\n        data: $ele,\n        temps,\n      });\n    }\n\n    defaults.ready && defaults.ready.call($ele);\n  } catch (error) {\n    const err = new Error(\n      `Render element error: ${ele.tagName} \\n  ${error.stack}`,\n      {\n        cause: error,\n      }\n    );\n    throw err;\n  }\n\n  if (defaults.watch) {\n    const wen = Object.entries(defaults.watch);\n\n    $ele.watchTick((e) => {\n      for (let [name, func] of wen) {\n        const names = name.split(\",\");\n\n        if (names.length >= 2) {\n          if (names.some((name) => e.hasModified(name))) {\n            func.call(\n              $ele,\n              names.map((name) => $ele[name]),\n              {\n                watchers: e,\n              }\n            );\n          }\n        } else {\n          if (e.hasModified(name)) {\n            func.call($ele, $ele[name], {\n              watchers: e,\n            });\n          }\n        }\n      }\n    });\n\n    for (let [name, func] of wen) {\n      const names = name.split(\",\");\n      if (names.length >= 2) {\n        func.call(\n          $ele,\n          names.map((name) => $ele[name]),\n          {}\n        );\n      } else {\n        func.call($ele, $ele[name], {});\n      }\n    }\n  }\n};\n\nexport const register = (opts = {}) => {\n  const defaults = {\n    // Registered component name\n    tag: \"\",\n    // Body content string\n    temp: \"\",\n    // Initialization data after element creation\n    data: {},\n    // Values that will not be traversed\n    proto: {},\n    // Keys bound to attributes\n    // attrs: {},\n    // The listener function for the element\n    // watch: {},\n    // Function triggered when the component is created (data initialization complete)\n    // created() { },\n    // Function triggered after component data initialization is complete (initial rendering completed)\n    // ready() { },\n    // Functions that are added to the document trigger\n    // attached() { },\n    // Functions triggered by moving out of the document\n    // detached() { },\n    // The container element is changed\n    // slotchange() { }\n    ...opts,\n  };\n\n  let template, temps, name;\n\n  try {\n    validateTagName(defaults.tag);\n\n    defaults.data = deepCopyData(defaults.data);\n\n    name = capitalizeFirstLetter(hyphenToUpperCase(defaults.tag));\n\n    if (COMPS[name]) {\n      throw new Error(`Component ${name} already exists`);\n    }\n\n    template = document.createElement(\"template\");\n    template.innerHTML = defaults.temp;\n    temps = convert(template);\n  } catch (error) {\n    const err = new Error(\n      `Register Component Error: ${defaults.tag} \\n  ${error.stack}`,\n      { cause: error }\n    );\n    throw err;\n  }\n\n  const getAttrKeys = (attrs) => {\n    let attrKeys;\n\n    if (attrs instanceof Array) {\n      attrKeys = [...attrs];\n    } else {\n      attrKeys = Object.keys(attrs);\n    }\n\n    return attrKeys;\n  };\n\n  const XElement = (COMPS[name] = class extends HTMLElement {\n    constructor(...args) {\n      super(...args);\n\n      const $ele = eleX(this);\n\n      defaults.created && defaults.created.call($ele);\n\n      if (defaults.attrs) {\n        const attrKeys = getAttrKeys(defaults.attrs);\n\n        // fix self attribule value\n        $ele.watchTick((e) => {\n          attrKeys.forEach((key) => {\n            if (e.hasModified(key)) {\n              const val = $ele[key];\n              const attrName = toDashCase(key);\n              const oldVal = this.getAttribute(attrName);\n              if (val === null || val === undefined) {\n                this.removeAttribute(attrName);\n              } else if (oldVal !== val) {\n                let reval = val;\n\n                const valType = getType(val);\n\n                if (valType === \"number\" && oldVal === String(val)) {\n                  // Setting the number will cause an infinite loop\n                  return;\n                }\n                if (valType === \"object\") {\n                  // Setting the object will cause an infinite loop\n                  reval = JSON.stringify(reval);\n                  if (reval === oldVal) {\n                    return;\n                  }\n                }\n\n                this.setAttribute(attrName, reval);\n              }\n            }\n          });\n        });\n\n        // The data set before initialization needs to be reflected in attrs\n        attrKeys.forEach((key) => {\n          if (\n            $ele[key] !== null &&\n            $ele[key] !== undefined &&\n            $ele[key] !== defaults.attrs[key]\n          ) {\n            this.setAttribute(toDashCase(key), $ele[key]);\n          }\n        });\n      }\n\n      renderElement({\n        defaults,\n        ele: this,\n        template,\n        temps,\n      });\n    }\n\n    connectedCallback() {\n      if (isInternal(this)) {\n        return;\n      }\n\n      defaults.attached && defaults.attached.call(eleX(this));\n    }\n\n    disconnectedCallback() {\n      if (isInternal(this)) {\n        return;\n      }\n\n      defaults.detached && defaults.detached.call(eleX(this));\n    }\n\n    attributeChangedCallback(name, oldValue, newValue) {\n      const $ele = eleX(this);\n\n      if (!/[^\\d.]/.test(newValue) && typeof $ele[name] === \"number\") {\n        newValue = Number(newValue);\n      }\n\n      $ele[hyphenToUpperCase(name)] = newValue;\n    }\n\n    static get observedAttributes() {\n      return getAttrKeys(defaults.attrs || {}).map((e) => toDashCase(e));\n    }\n  });\n\n  if (document.readyState !== \"loading\") {\n    customElements.define(defaults.tag, XElement);\n  } else {\n    const READYSTATE = \"readystatechange\";\n    let f;\n    document.addEventListener(\n      READYSTATE,\n      (f = () => {\n        customElements.define(defaults.tag, XElement);\n        document.removeEventListener(READYSTATE, f);\n      })\n    );\n  }\n};\n\nfunction isInternal(ele) {\n  let target = ele;\n\n  while (target) {\n    if (target.__internal) {\n      return true;\n    }\n\n    target = target.parentNode || target.host;\n\n    if (!target || (target.tagName && target.tagName === \"BODY\")) {\n      break;\n    }\n  }\n\n  return false;\n}\n\nfunction validateTagName(str) {\n  // Check if the string starts or ends with '-'\n  if (str.charAt(0) === \"-\" || str.charAt(str.length - 1) === \"-\") {\n    throw new Error(`The string \"${str}\" cannot start or end with \"-\"`);\n  }\n\n  // Check if the string has consecutive '-' characters\n  for (let i = 0; i < str.length - 1; i++) {\n    if (str.charAt(i) === \"-\" && str.charAt(i + 1) === \"-\") {\n      throw new Error(\n        `The string \"${str}\" cannot have consecutive \"-\" characters`\n      );\n    }\n  }\n\n  // Check if the string has at least one '-' character\n  if (!str.includes(\"-\")) {\n    throw new Error(`The string \"${str}\" must contain at least one \"-\"`);\n  }\n\n  return true;\n}\n\nfunction deepCopyData(obj) {\n  if (obj instanceof Set || obj instanceof Map) {\n    throw new Error(\n      \"The data of the registered component should contain only regular data types such as String, Number, Object and Array. for other data types, please set them after ready.\"\n    );\n  }\n\n  if (obj instanceof Function) {\n    throw new Error(\n      `Please write the function in the 'proto' property object.`\n    );\n  }\n\n  if (typeof obj !== \"object\" || obj === null) {\n    return obj;\n  }\n\n  const copy = Array.isArray(obj) ? [] : {};\n\n  for (let key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      copy[key] = deepCopyData(obj[key]);\n    }\n  }\n\n  return copy;\n}\n","import { renderExtends } from \"./render.mjs\";\nimport { isSafariBrowser } from \"../public.mjs\";\n\nexport class FakeNode extends Comment {\n  constructor(markname) {\n    const tagText = `Fake Node${markname ? \": \" + markname : \"\"}`;\n\n    super(` ${tagText} --end `);\n\n    this._mark = markname;\n    this._inited = false;\n\n    const startCom = new Comment(` ${tagText} --start `);\n    startCom.__fake_end = this;\n\n    Object.defineProperty(this, \"_start\", {\n      value: startCom,\n    });\n  }\n\n  init() {\n    if (this._inited) {\n      return;\n    }\n\n    this.parentNode.insertBefore(this._start, this);\n    this._inited = true;\n  }\n\n  querySelector(expr) {\n    return this.__searchEl(expr, \"find\");\n  }\n\n  querySelectorAll(expr) {\n    return this.__searchEl(expr);\n  }\n\n  __searchEl(expr, funcName = \"filter\") {\n    const startParent = this.parentNode;\n    if (!startParent) return [];\n\n    const childs = this.children;\n\n    return Array.from(startParent.querySelectorAll(expr))[funcName]((e) => {\n      let par = e;\n      while (true) {\n        if (childs.includes(par)) {\n          return true;\n        }\n\n        par = par.parentNode;\n\n        if (!par) {\n          break;\n        }\n      }\n    });\n  }\n\n  insertBefore(newEle, target) {\n    const { parentNode } = this;\n\n    if (Array.from(parentNode.children).includes(target)) {\n      parentNode.insertBefore(newEle, target);\n    } else {\n      parentNode.insertBefore(newEle, this);\n    }\n  }\n\n  appendChild(newEle) {\n    this.parentNode.insertBefore(newEle, this);\n  }\n\n  get children() {\n    const childs = [];\n\n    let prev = this;\n    while (true) {\n      prev = prev.previousSibling;\n\n      if (prev) {\n        if (prev instanceof HTMLElement) {\n          childs.unshift(prev);\n        } else if (prev === this._start) {\n          break;\n        }\n      } else {\n        throw new Error(`This is an unclosed FakeNode`);\n      }\n    }\n\n    return childs;\n  }\n\n  get childNodes() {\n    const childs = [];\n\n    let prev = this;\n    while (true) {\n      prev = prev.previousSibling;\n\n      if (prev) {\n        if (prev === this._start) {\n          break;\n        }\n        childs.unshift(prev);\n      } else {\n        throw new Error(`This is an unclosed FakeNode`);\n      }\n    }\n\n    return childs;\n  }\n\n  set innerHTML(val) {\n    this.childNodes.forEach((e) => {\n      e.remove();\n    });\n\n    const temp = document.createElement(\"template\");\n    temp.innerHTML = val;\n\n    Array.from(temp.content.childNodes).forEach((e) => {\n      this.appendChild(e);\n    });\n  }\n\n  get innerHTML() {\n    const { children } = this;\n    let content = \"\";\n\n    children.forEach((e) => {\n      content += e.outerHTML + \"\\n\";\n    });\n\n    return content;\n  }\n\n  get nextElementSibling() {\n    let next = this.nextSibling;\n\n    if (!next) {\n      return null;\n    }\n\n    if (next.__fake_end) {\n      return next.__fake_end;\n    }\n\n    if (next && !(next instanceof Element)) {\n      next = next.nextElementSibling;\n    }\n\n    return next;\n  }\n\n  get previousElementSibling() {\n    const { _start } = this;\n    let prev = _start.previousSibling;\n\n    if (!prev) {\n      return null;\n    }\n\n    if (prev instanceof FakeNode) {\n      return prev;\n    }\n\n    return _start.previousElementSibling;\n  }\n}\n\nconst replaceTempInit = (_this) => {\n  const parent = _this.parentNode;\n  if (parent) {\n    const parent = _this.parentNode;\n    Array.from(_this.content.children).forEach((e) => {\n      parent.insertBefore(e, _this);\n    });\n\n    _this.remove();\n  }\n};\n\nif (isSafariBrowser()) {\n  renderExtends.beforeRender = ({ target }) => {\n    let replaces = [];\n    while (true) {\n      replaces = Array.from(\n        target.querySelectorAll('template[is=\"replace-temp\"]')\n      );\n\n      if (!replaces.length) {\n        break;\n      }\n\n      replaces.forEach((temp) => {\n        replaceTempInit(temp);\n      });\n    }\n  };\n} else {\n  class ReplaceTemp extends HTMLTemplateElement {\n    constructor() {\n      super();\n      this.init();\n    }\n\n    init() {\n      replaceTempInit(this);\n    }\n\n    connectedCallback() {\n      this.init();\n    }\n  }\n\n  customElements.define(\"replace-temp\", ReplaceTemp, {\n    extends: \"template\",\n  });\n}\n","/**\n * `x-if` first replaces all neighboring conditional elements with token elements and triggers the rendering process once; the rendering process is triggered again after each `value` change.\n * The rendering process is as follows:\n * 1. First, collect all conditional elements adjacent to `x-if`.\n * 2. Mark these elements and wait for the `value` of each conditional element to be set successfully before proceeding to the next step.\n * 3. Based on the marking, perform a judgment operation asynchronously, the element that satisfies the condition first will be rendered; after successful rendering, the subsequent conditional elements will clear the rendered content.\n */\n\nimport { dataRevoked } from \"../../stanz/public.mjs\";\nimport { register } from \"../register.mjs\";\nimport { eleX, revokeAll } from \"../util.mjs\";\nimport { FakeNode } from \"./fake-node.mjs\";\nimport { render } from \"./render.mjs\";\n\nconst regOptions = {\n  data: {\n    value: null,\n    __rendered: false,\n  },\n  watch: {\n    value() {\n      if (!this._bindend) {\n        return;\n      }\n\n      this.refreshValue();\n    },\n  },\n  proto: {\n    refreshValue() {\n      clearTimeout(this._timer);\n      this._timer = setTimeout(() => {\n        const conditions = [this, ...this._others];\n\n        let isOK = false;\n\n        conditions.forEach((conditionEl) => {\n          if (isOK) {\n            // A success condition has preceded it, and any subsequent conditional elements should be clear\n            conditionEl._clearContent();\n            return;\n          }\n\n          if (conditionEl.value || conditionEl.tag === \"x-else\") {\n            isOK = true;\n            conditionEl._renderContent();\n          } else {\n            conditionEl._clearContent();\n          }\n        });\n        if (this._fake.parentNode) {\n          eleX(this._fake.parentNode).refresh();\n        }\n\n        // const fakeParent = eleX(this._fake.parentNode);\n        // fakeParent.refresh();\n        // fakeParent.host && fakeParent.host.refresh({ unupdate: 1 });\n      }, 0);\n    },\n    _renderContent() {\n      if (this.__rendered) {\n        return;\n      }\n      this.__rendered = true;\n\n      const result = getRenderData(this._fake);\n\n      if (!result) {\n        return;\n      }\n\n      const { target, data, temps } = result;\n\n      if (dataRevoked(data)) {\n        return;\n      }\n\n      this._fake.innerHTML = this.__originHTML;\n\n      render({ target, data, temps });\n\n      this.emit(\"rendered\", {\n        bubbles: false,\n      });\n    },\n    _clearContent() {\n      if (!this.__rendered) {\n        return;\n      }\n\n      this.__rendered = false;\n\n      revokeAll(this._fake);\n      this._fake.innerHTML = \"\";\n\n      this.emit(\"clear\", {\n        bubbles: false,\n      });\n    },\n    init() {\n      if (this._bindend) {\n        return;\n      }\n\n      this._bindend = true;\n      const fake = (this._fake = new FakeNode(this.tag));\n      this.before(fake);\n      fake.init();\n      this.remove();\n\n      // 给 else-if 添加 _xif，给 else 初始化\n      if (this.tag === \"x-if\") {\n        const others = (this._others = []);\n\n        let next = fake;\n        while (true) {\n          next = next.nextElementSibling;\n\n          if (!next) {\n            break;\n          }\n\n          switch (next.tagName) {\n            case \"X-ELSE\": {\n              const $el = eleX(next);\n              if ($el.init) {\n                $el.init();\n              } else {\n                $el._if_ready = 1;\n              }\n\n              others.push($el);\n              return;\n            }\n            case \"X-ELSE-IF\": {\n              const $el = eleX(next);\n\n              $el._xif = this;\n\n              others.push($el);\n              break;\n            }\n            default:\n              break;\n          }\n        }\n      }\n    },\n  },\n  created() {\n    this.__originHTML = this.$(\"template[condition]\").html;\n    this.html = \"\";\n  },\n  ready() {\n    if (this.ele._bindingRendered) {\n      this.init();\n    } else {\n      this.one(\"binding-rendered\", () => this.init());\n    }\n  },\n};\n\nregister({\n  tag: \"x-if\",\n  ...regOptions,\n});\n\nregister({\n  tag: \"x-else-if\",\n  ...regOptions,\n  watch: {\n    value() {\n      if (!this._bindend) {\n        return;\n      }\n\n      if (this._xif) {\n        this._xif.refreshValue();\n      }\n    },\n  },\n});\n\nregister({\n  tag: \"x-else\",\n  ...regOptions,\n  watch: {},\n  ready() {\n    if (this._if_ready) {\n      this.init();\n    }\n  },\n});\n\nexport const getRenderData = (target) => {\n  while (target && !target.__render_data) {\n    target = target.parentNode;\n  }\n\n  if (target) {\n    return {\n      target,\n      data: target.__render_data,\n      temps: target.__render_temps,\n    };\n  }\n\n  return null;\n};\n","import { register } from \"../register.mjs\";\nimport { render } from \"./render.mjs\";\nimport { FakeNode } from \"./fake-node.mjs\";\nimport Stanz from \"../../stanz/main.mjs\";\nimport { createXEle, eleX, revokeAll } from \"../util.mjs\";\nimport { removeArrayValue } from \"../public.mjs\";\nimport { getRenderData } from \"./condition.mjs\";\n\nregister({\n  tag: \"x-fill\",\n  data: {\n    value: null,\n  },\n  watch: {\n    value(value, t) {\n      this.refreshValue(t?.watchers);\n    },\n  },\n  proto: {\n    refreshValue(watchers) {\n      const arrayData = this.value;\n\n      if (!this._bindend) {\n        return;\n      }\n\n      const childs = this._fake.children;\n\n      if (!arrayData) {\n        childs.forEach((e) => revokeAll(e));\n        this._fake.innerHTML = \"\";\n        return;\n      }\n\n      if (!(arrayData instanceof Array)) {\n        console.warn(\n          `The value of x-fill component must be of type Array, and the type of the current value is ${getType(\n            arrayData\n          )}`\n        );\n\n        childs &&\n          childs.forEach((el) => {\n            revokeAll(el);\n            el.remove();\n          });\n        return;\n      }\n\n      const regData = getRenderData(this._fake);\n\n      if (!regData) {\n        return;\n      }\n\n      const { data, temps } = regData;\n\n      const targetTemp = temps[this._name];\n\n      const keyName = this.attr(\"fill-key\") || \"xid\";\n\n      if (!childs.length) {\n        const frag = document.createDocumentFragment();\n\n        arrayData.forEach((e, i) => {\n          const $ele = createItem(\n            e,\n            temps,\n            targetTemp,\n            data.$host || data,\n            i,\n            keyName\n          );\n          frag.appendChild($ele.ele);\n        });\n\n        this._fake.appendChild(frag);\n      } else {\n        if (watchers) {\n          const isReplaced = watchers.some((e) => e.path.length <= 1);\n\n          if (!isReplaced) {\n            // It is not a replacement, it can be corrected by binding the item internally.\n            return;\n          }\n        }\n\n        const vals = arrayData.slice();\n        const valsKeys = new Set(\n          vals.map((e) => {\n            const val = e[keyName];\n            return val === undefined ? e : val;\n          })\n        );\n\n        const { parentNode } = this._fake;\n\n        if (keyName !== \"xid\" && vals.length !== valsKeys.size) {\n          const errDesc = \"fill key duplicates\";\n          console.error(errDesc);\n          console.log(\n            errDesc,\n            \",its parent node is:\",\n            parentNode,\n            \"host: \",\n            eleX(parentNode)?.host?.ele\n          );\n        }\n\n        // const positionKeys = childs.map((e) => e._data_xid || e);\n        // Delete non-existing projects in advance (used to improve performance, this step can be removed and the above comment is turned on)\n        const positionKeys = [];\n        for (let i = 0, len = childs.length; i < len; i++) {\n          const e = childs[i];\n          const key = e._data_xid || e;\n\n          if (!valsKeys.has(key)) {\n            // If it no longer exists, delete it in advance.\n            revokeAll(e);\n            e.remove();\n            childs.splice(i, 1);\n            len--;\n            i--;\n          } else {\n            positionKeys.push(key);\n          }\n        }\n\n        let target = this._fake._start;\n\n        const needRemoves = [];\n\n        let count = 0;\n\n        while (target) {\n          if (target === this._fake) {\n            if (vals.length) {\n              // We have reached the end, add all elements directly to the front\n              vals.forEach((item) => {\n                const $ele = createItem(\n                  item,\n                  temps,\n                  targetTemp,\n                  data.$host || data,\n                  count,\n                  keyName\n                );\n\n                count++;\n\n                // target.parentNode.insertBefore($ele.ele, target);\n                parentNode.insertBefore($ele.ele, target);\n              });\n            }\n            break;\n          }\n          if (!(target instanceof Element)) {\n            target = target.nextSibling;\n            continue;\n          }\n          const currentVal = vals.shift();\n          const isObj = currentVal instanceof Object;\n          const $tar = eleX(target);\n          const item = $tar.__item;\n\n          if (currentVal === undefined && !vals.length) {\n            // There will be no follow-up, just delete it directly\n            needRemoves.push(target);\n            target = target.nextSibling;\n            continue;\n          }\n\n          const oldId = positionKeys.indexOf(\n            isObj ? currentVal[keyName] : currentVal\n          );\n          if (oldId > -1) {\n            // If the key originally exists, perform key displacement.\n            const oldItem = childs[oldId];\n            if (\n              isObj\n                ? currentVal[keyName] !== item.$data[keyName]\n                : currentVal !== item.$data\n            ) {\n              // Adjust position\n              oldItem.__internal = 1;\n              // target.parentNode.insertBefore(oldItem, target);\n              parentNode.insertBefore(oldItem, target);\n              delete oldItem.__internal;\n              target = oldItem;\n            }\n\n            // Update object\n            const $old = eleX(oldItem);\n            if ($old.__item.$data !== currentVal) {\n              $old.__item.$data = currentVal;\n            }\n            $old.__item.$index = count;\n          } else {\n            // Add new element\n            const $ele = createItem(\n              currentVal,\n              temps,\n              targetTemp,\n              data.$host || data,\n              count,\n              keyName\n            );\n\n            // target.parentNode.insertBefore($ele.ele, target);\n            parentNode.insertBefore($ele.ele, target);\n            target = $ele.ele;\n          }\n\n          count++;\n          target = target.nextSibling;\n        }\n\n        if (needRemoves.length) {\n          needRemoves.forEach((e) => {\n            revokeAll(e);\n            e.remove();\n          });\n        }\n      }\n\n      if (this._fake.parentNode) {\n        eleX(this._fake.parentNode).refresh();\n      }\n\n      this.emit(\"rendered\", {\n        bubbles: false,\n      });\n    },\n    init() {\n      if (this._bindend) {\n        return;\n      }\n      this._bindend = true;\n      const fake = (this._fake = new FakeNode(\"x-fill\"));\n      this.before(fake);\n      fake.init();\n      this.remove();\n\n      this.refreshValue();\n    },\n  },\n  ready() {\n    this._name = this.attr(\"name\");\n\n    if (!this._name) {\n      const desc =\n        \"The target element does not have a template name to populate\";\n      console.log(desc, this.ele);\n      throw new Error(desc);\n    }\n\n    if (this.ele._bindingRendered) {\n      this.init();\n    } else {\n      this.one(\"binding-rendered\", () => this.init());\n    }\n  },\n});\n\nconst createItem = ($data, temps, targetTemp, $host, $index, keyName) => {\n  const $ele = createXEle(targetTemp.innerHTML);\n\n  const itemData = new Stanz({\n    $data,\n    $ele,\n    $host,\n    $index,\n  });\n\n  render({\n    target: $ele.ele,\n    data: itemData,\n    temps,\n    $host,\n    isRenderSelf: true,\n  });\n\n  const revokes = $ele.ele.__revokes;\n\n  const revoke = () => {\n    removeArrayValue(revokes, revoke);\n    itemData.revoke();\n  };\n\n  revokes.push(revoke);\n\n  $ele.__item = itemData;\n  $ele.ele._data_xid = $data[keyName] || $data;\n\n  return $ele;\n};\n","import { createXEle, eleX } from \"./util.mjs\";\nimport { meetsEle, searchEle } from \"./public.mjs\";\nimport { handler } from \"./accessor.mjs\";\nimport renderFn from \"./render/render.mjs\";\nimport syncFn from \"./render/sync.mjs\";\nimport eventFn from \"./event.mjs\";\nimport LikeArray from \"./array.mjs\";\nimport formFn, { initFormEle } from \"./form.mjs\";\nimport cssFn from \"./css.mjs\";\nimport { extend } from \"../stanz/public.mjs\";\nimport Stanz, { constructor } from \"../stanz/main.mjs\";\nimport watchFn from \"../stanz/watch.mjs\";\nimport \"./render/condition.mjs\";\nimport \"./render/fill.mjs\";\nconst { defineProperties } = Object;\n\nconst init = ({ _this, ele, proxySelf }) => {\n  const descs = {\n    owner: {\n      get() {\n        const { parentNode } = ele;\n        const { _owner } = _this;\n        const arr = parentNode ? [eleX(parentNode), ..._owner] : [..._owner];\n        return new Set(arr);\n      },\n    },\n    ele: {\n      get: () => ele,\n    },\n  };\n\n  const tag = ele.tagName && ele.tagName.toLowerCase();\n\n  if (tag) {\n    descs.tag = {\n      enumerable: true,\n      value: tag,\n    };\n  }\n\n  defineProperties(_this, descs);\n\n  initFormEle(proxySelf);\n};\n\nexport default class Xhear extends LikeArray {\n  constructor({ ele }) {\n    super();\n\n    const proxySelf = constructor.call(this, {}, handler);\n\n    init({\n      _this: this,\n      ele,\n      proxySelf,\n    });\n\n    ele.__xhear__ = proxySelf;\n\n    return proxySelf;\n  }\n\n  get length() {\n    return this.ele && this.ele.children.length;\n  }\n\n  $(expr) {\n    let { ele } = this;\n    if (ele instanceof HTMLTemplateElement) {\n      ele = ele.content;\n    }\n\n    const target = ele.querySelector(expr);\n    return target ? eleX(target) : null;\n  }\n\n  all(expr) {\n    return searchEle(this.ele, expr).map(eleX);\n  }\n\n  extend(obj, desc) {\n    return extend(this, obj, desc);\n  }\n\n  get text() {\n    return this.ele.textContent;\n  }\n\n  set text(val) {\n    this.ele.textContent = val;\n  }\n\n  get html() {\n    return this.ele.innerHTML;\n  }\n\n  set html(val) {\n    this.ele.innerHTML = val;\n  }\n\n  get classList() {\n    return this.ele.classList;\n  }\n\n  get data() {\n    return this.ele.dataset;\n  }\n\n  get shadow() {\n    return eleX(this.ele.shadowRoot);\n  }\n\n  get root() {\n    const rootNode = this.ele.getRootNode();\n    return rootNode ? eleX(rootNode) : null;\n  }\n  get host() {\n    let root = this.ele.getRootNode();\n    let { host } = root;\n    return host instanceof Node ? eleX(host) : null;\n  }\n\n  get parent() {\n    let { parentNode } = this.ele;\n    return !parentNode || parentNode === document ? null : eleX(parentNode);\n  }\n\n  get parents() {\n    const parents = [];\n    let target = this;\n    while (target.parent) {\n      target = target.parent;\n      parents.push(target);\n    }\n    return parents;\n  }\n\n  get next() {\n    const nextEle = this.ele.nextElementSibling;\n    return nextEle ? eleX(nextEle) : null;\n  }\n\n  after(val) {\n    const { next: nextEl } = this;\n\n    if (nextEl) {\n      nextEl.before(val);\n    } else {\n      this.parent.push(val);\n    }\n  }\n\n  get nexts() {\n    const { parent } = this;\n    const selfIndex = this.index;\n    return parent.filter((e, i) => i > selfIndex);\n  }\n\n  get prev() {\n    const prevEle = this.ele.previousElementSibling;\n    return prevEle ? eleX(prevEle) : null;\n  }\n\n  before(val) {\n    const $el = createXEle(val);\n    this.parent.ele.insertBefore($el.ele, this.ele);\n  }\n\n  get prevs() {\n    const { parent } = this;\n    const selfIndex = this.index;\n    return parent.filter((e, i) => i < selfIndex);\n  }\n\n  get siblings() {\n    return this.parent.filter((e) => e !== this);\n  }\n\n  get index() {\n    let { parentNode } = this.ele;\n\n    if (!parentNode) {\n      return null;\n    }\n\n    return Array.prototype.indexOf.call(parentNode.children, this.ele);\n  }\n\n  get style() {\n    return this.ele.style;\n  }\n\n  get width() {\n    return parseInt(getComputedStyle(this.ele).width) || 0;\n  }\n\n  get height() {\n    return parseInt(getComputedStyle(this.ele).height) || 0;\n  }\n\n  get clientWidth() {\n    return this.ele.clientWidth;\n  }\n\n  get clientHeight() {\n    return this.ele.clientHeight;\n  }\n\n  get offsetWidth() {\n    return this.ele.offsetWidth;\n  }\n\n  get offsetHeight() {\n    return this.ele.offsetHeight;\n  }\n\n  get outerWidth() {\n    let computedStyle = getComputedStyle(this.ele);\n    return (\n      this.ele.offsetWidth +\n      parseInt(computedStyle[\"margin-left\"]) +\n      parseInt(computedStyle[\"margin-right\"])\n    );\n  }\n\n  get outerHeight() {\n    let computedStyle = getComputedStyle(this.ele);\n    return (\n      this.ele.offsetHeight +\n      parseInt(computedStyle[\"margin-top\"]) +\n      parseInt(computedStyle[\"margin-bottom\"])\n    );\n  }\n\n  is(expr) {\n    return meetsEle(this.ele, expr);\n  }\n\n  remove() {\n    const { parent } = this;\n    if (parent) {\n      parent.splice(parent.indexOf(this), 1);\n    }\n    // this.ele.remove();\n  }\n\n  clone(bool = true) {\n    return eleX(this.ele.cloneNode(bool));\n  }\n\n  wrap(content) {\n    const $el = createXEle(content);\n\n    const { ele } = this;\n\n    if (!ele.parentNode) {\n      throw new Error(\n        `The target has a sibling element, so you can't use unwrap`\n      );\n    }\n\n    ele.parentNode.insertBefore($el.ele, ele);\n\n    ele.__internal = 1;\n\n    $el.ele.appendChild(ele);\n\n    delete ele.__internal;\n\n    return this;\n  }\n\n  unwrap() {\n    const { ele } = this;\n\n    const target = ele.parentNode;\n\n    if (target.children.length > 1) {\n      throw new Error(`The element itself must have a parent`);\n    }\n\n    ele.__internal = 1;\n\n    target.parentNode.insertBefore(ele, target);\n\n    target.remove();\n\n    delete ele.__internal;\n\n    return this;\n  }\n}\n\nconst sfn = Stanz.prototype;\nconst fn = Xhear.prototype;\n\nfn.extend(\n  {\n    get: sfn.get,\n    set: sfn.set,\n    toJSON: sfn.toJSON,\n    toString: sfn.toString,\n    ...watchFn,\n    ...eventFn,\n    ...renderFn,\n    ...syncFn,\n    ...formFn,\n  },\n  {\n    enumerable: false,\n  }\n);\n\nfn.extend(cssFn);\n","import Xhear from \"./main.mjs\";\nimport { getType } from \"../stanz/public.mjs\";\n\nexport const eleX = (ele) => {\n  if (!ele) return null;\n\n  if (ele.__xhear__) {\n    return ele.__xhear__;\n  }\n\n  return new Xhear({ ele });\n};\n\nexport const objToXEle = (obj) => {\n  const data = { ...obj };\n\n  if (!obj.tag) {\n    return null;\n  }\n\n  const ele = document.createElement(obj.tag);\n  delete data.tag;\n  const $ele = eleX(ele);\n\n  Object.assign($ele, data);\n\n  return $ele;\n};\n\nconst temp = document.createElement(\"template\");\n\nexport const strToXEle = (str) => {\n  temp.innerHTML = str;\n  const ele = temp.content.children[0] || temp.content.childNodes[0];\n  temp.innerHTML = \"\";\n\n  return eleX(ele);\n};\n\nexport const createXEle = (expr, exprType) => {\n  if (expr instanceof Xhear) {\n    return expr;\n  }\n\n  if (expr instanceof Node || expr === window) {\n    return eleX(expr);\n  }\n\n  const type = getType(expr);\n\n  switch (type) {\n    case \"object\":\n      return objToXEle(expr);\n    case \"string\":\n      return strToXEle(expr);\n  }\n};\n\nexport const revokeAll = (target) => {\n  if (target.__revokes) {\n    Array.from(target.__revokes).forEach((f) => f && f());\n  }\n  target.childNodes &&\n    Array.from(target.childNodes).forEach((el) => {\n      revokeAll(el);\n    });\n\n  const revokes = target?.shadowRoot?.__revokes;\n\n  if (revokes) {\n    [...revokes].forEach((f) => f());\n  }\n};\n","import { eleX, createXEle } from \"./util.mjs\";\nimport { getType } from \"../stanz/public.mjs\";\n\nexport default function $(expr) {\n  if (getType(expr) === \"string\" && !/<.+>/.test(expr)) {\n    const ele = document.querySelector(expr);\n\n    return eleX(ele);\n  }\n\n  return createXEle(expr);\n}\n\nObject.defineProperties($, {\n  // Convenient objects for use as extensions\n  extensions: {\n    value: {},\n  },\n});\n","import { eleX } from \"./util.mjs\";\nimport { render, convert } from \"./render/render.mjs\";\nimport Xhear from \"./main.mjs\";\nimport stanz from \"../stanz/base.mjs\";\nimport { register } from \"./register.mjs\";\nimport { searchEle } from \"./public.mjs\";\nimport $ from \"./dollar.mjs\";\nimport { nextTick } from \"../stanz/public.mjs\";\n\nObject.assign($, {\n  stanz,\n  render,\n  convert,\n  register,\n  nextTick,\n  fn: Xhear.prototype,\n  all: (expr) => searchEle(document, expr).map(eleX),\n  frag: () => $(document.createDocumentFragment()),\n});\n\nexport default $;\n"],"names":["getRandomId","Math","random","toString","slice","objectToString","Object","prototype","getType","value","call","toLowerCase","replace","isObject","obj","type","isDebug","document","currentScript","attributes","hasOwnProperty","afterTimer","asyncsCounter","tickSets","Set","nextTick","callback","clearTimeout","setTimeout","Promise","resolve","then","desc","console","error","lastCall","Error","tickId","add","clear","has","delete","extend","_this","proto","descriptor","getOwnPropertyNames","getOwnPropertySymbols","forEach","k","result","getOwnPropertyDescriptor","configurable","enumerable","writable","get","set","defineProperty","dataRevoked","data","xid","err","isRevokedErr","firstLine","stack","split","includes","isFunction","val","hyphenToUpperCase","str","match","p1","toUpperCase","toDashCase","meetsEle","ele","expr","temp","createElement","content","append","cloneNode","querySelector","removeArrayValue","arr","target","index","indexOf","splice","searchEle","el","HTMLTemplateElement","Array","from","querySelectorAll","assign","freeze","Watcher","constructor","opts","this","hasModified","path","currentTarget","keys","name","positionIndex","getModifieds","currentKeys","length","hasReplaced","modifieds","cloneKeys","targetKey","shift","push","Watchers","super","key","some","e","emitUpdate","oldValue","args","warn","options","_hasWatchs","watcher","WATCHS","func","_update","owner","parent","watchFn","watch","wid","unwatch","watchTick","wait","timeout","hisArgs","debounce","filter","item","refresh","watchUntil","f","tid","mutatingMethods","holder","Symbol","fn","arrayFn","methodName","backupArr","reval","apply","SELF","deletedItems","addedItems","oldArray","newArray","backupNewArray","backupOldArray","Map","oldLen","i","oldItem","newIndex","newLen","newItem","oldIndex","compareArrays","isxdata","_owner","__unupdate","clearData","PROXY","oldFunc","Function","defineProperties","entries","ISXDATA","handler","stanzHandler","watchs","proxy","proxySelf","revoke","Proxy","revocable","_revoke","descObj","Stanz","self","_onrevokes","toJSON","isPureArray","maxId","test","parseInt","JSON","stringify","len","join","cause","lastKey","pop","setData","receiver","succeed","isSame","mismatch","Reflect","deleteProperty","undefined","String","eleX","children","ownKeys","renderExtends","beforeRender","render","getRevokes","__revokes","addRevoke","convertToFunc","funcStr","bind","template","temps","isRenderSelf","otherOpts","innerHTML","texts","tasks","revokes","originStyle","matchs","map","dataExpr","renderStyle","afterStyle","revokeStyle","remove","textEl","createTextNode","parentNode","insertBefore","removeChild","getAttribute","renderFunc","textContent","textRevoke","eles","unshift","bindData","parse","$el","actionName","always","workResult","afterArgs","work","errCall","outerHTML","element","beforeArgs","step","clearRevs","methodRevoke","removeAttribute","_bindingRendered","dispatchEvent","Event","__render_temps","isEmptyObject","__render_data","old","new","convertEl","tagName","attr","matchData","exec","param0","setAttribute","searchTemp","rearr","isWarned","convert","codeEls","code","cid","tempName","tempChilds","wrapName","fillEl","trim","appendChild","condiEl","firstChild","newTemps","getVal","defaultData","prop","class","classList","contains","$ele","propName","syncFn","sync","targetName","log","wid1","wid2","getBindOptions","revoker","beforeValue","removeEventListener","eventFn","on","addEventListener","one","off","emit","event","bubbles","originSplice","start","count","items","removes","frag","createDocumentFragment","createXEle","positionEle","likeArrayFn","targets","reVal","reverse","childs","childNodes","__internal","sort","getOwnPropertyDescriptors","targetFunc","LikeArray","stanz","is","setKeys","isNum","Number","formEleNames","bindProp","keyName","initInput","getFormData","all","tag","checked","files","selectedsOpt","multiple","formFn","formData","newData","obj1","obj2","mergeObjects","isUseValue","resetValue","oldRevoke","cssHandler","_ele","style","getComputedStyle","XhearCSS","_css","cssFn","css","d","nextKeys","COMPS","register","defaults","charAt","validateTagName","deepCopyData","getAttrKeys","attrs","attrKeys","XElement","HTMLElement","created","attrName","oldVal","valType","root","attachShadow","mode","ready","wen","names","watchers","renderElement","connectedCallback","isInternal","attached","disconnectedCallback","detached","attributeChangedCallback","newValue","observedAttributes","readyState","customElements","define","READYSTATE","host","copy","isArray","FakeNode","Comment","markname","tagText","_mark","_inited","startCom","__fake_end","init","_start","__searchEl","funcName","startParent","par","newEle","prev","previousSibling","nextElementSibling","next","nextSibling","Element","previousElementSibling","replaceTempInit","navigator","userAgent","replaces","ReplaceTemp","extends","regOptions","__rendered","_bindend","refreshValue","_timer","conditions","_others","isOK","conditionEl","_clearContent","_renderContent","_fake","getRenderData","__originHTML","revokeAll","fake","before","others","_if_ready","_xif","$","html","t","arrayData","regData","targetTemp","_name","vals","valsKeys","size","errDesc","positionKeys","_data_xid","needRemoves","createItem","$host","currentVal","isObj","__item","oldId","$data","$old","$index","itemData","descs","initFormEle","Xhear","__xhear__","text","dataset","shadow","shadowRoot","rootNode","getRootNode","Node","parents","nextEle","after","nextEl","nexts","selfIndex","prevEle","prevs","siblings","width","height","clientWidth","clientHeight","offsetWidth","offsetHeight","outerWidth","computedStyle","outerHeight","clone","bool","wrap","unwrap","sfn","renderFn","exprType","window","objToXEle","strToXEle","extensions"],"mappings":"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"}